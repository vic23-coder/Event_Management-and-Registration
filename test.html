<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management System - Multi-Role Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 2px solid #f0f0f0;
            text-align: center;
        }

        .sidebar-header h2 {
            color: #333;
            font-size: 1.2rem;
        }

        .sidebar-header p {
            color: #667eea;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: #f5f5f5;
            border-left-color: #667eea;
        }

        .nav-item.active {
            background: #e7f3ff;
            color: #667eea;
            border-left-color: #667eea;
            font-weight: 600;
        }

        .nav-item span {
            margin-right: 10px;
        }

        .user-info {
            padding: 20px;
            border-top: 2px solid #f0f0f0;
            background: #f9f9f9;
        }

        .user-badge {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            text-align: center;
            margin-bottom: 10px;
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #da190b;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
            overflow-y: auto;
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Login/Register Page */
        .auth-page {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .role-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 30px;
        }

        .role-tab {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
            color: #333;
        }

        .role-tab:hover {
            border-color: #667eea;
        }

        .role-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="tel"],
        input[type="datetime-local"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #e68900;
        }

        .toggle-auth {
            text-align: center;
            margin-top: 20px;
        }

        .toggle-auth a {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Dashboard Page */
        .dashboard-header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-title h1 {
            color: #333;
            font-size: 2rem;
        }

        .dashboard-title p {
            color: #666;
            margin-top: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            font-size: 2rem;
        }

        .card-header h3 {
            color: #333;
            font-size: 1.3rem;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .button-group button {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .table-container {
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead {
            background: #f5f5f5;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table tr:hover {
            background: #f9f9f9;
        }

        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .nav-menu {
                display: flex;
                gap: 10px;
                overflow-x: auto;
                padding: 10px;
            }

            .role-tabs {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar" style="display: none;">
            <div class="sidebar-header">
                <h2>üéØ Event Manager</h2>
                <p id="currentRole">Loading...</p>
            </div>

            <div class="nav-menu" id="navMenu">
                <!-- Nav items will be populated by JavaScript -->
            </div>

            <div class="user-info">
                <div class="user-badge" id="userBadge">User</div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Auth Page -->
            <div id="authPage" class="page active">
                <div class="auth-page">
                    <div class="auth-header">
                        <h1>üéØ Event Management System</h1>
                        <p>Register or Login to continue</p>
                    </div>

                    <!-- Role Tabs -->
                    <div class="role-tabs">
                        <div class="role-tab active" onclick="switchRole('user')">üë§ User</div>
                        <div class="role-tab" onclick="switchRole('organizer')">üé™ Organizer</div>
                        <div class="role-tab" onclick="switchRole('admin')">üë®‚Äçüíº Admin</div>
                    </div>

                    <!-- User Forms -->
                    <div id="userAuth">
                        <!-- Login Form -->
                        <div class="auth-form active" id="userLoginForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üë§ User Login</h3>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="userLoginEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="userLoginPassword" placeholder="Enter password">
                            </div>
                            <button class="btn btn-primary" onclick="userLogin()">Login</button>
                            <div class="toggle-auth">Don't have an account? <a onclick="toggleUserForm('user')">Register</a></div>
                            <div id="userLoginResult" class="result"></div>
                        </div>

                        <!-- Register Form -->
                        <div class="auth-form" id="userRegisterForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üë§ User Registration</h3>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="userRegUsername" placeholder="Choose username">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="userRegEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="userRegPassword" placeholder="Create password">
                            </div>
                            <div class="form-group">
                                <label>Confirm Password</label>
                                <input type="password" id="userRegPasswordConfirm" placeholder="Confirm password">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="userRegPhone" placeholder="e.g., +1-234-567-8900 or 1234567890">
                            </div>
                            <button class="btn btn-primary" onclick="userRegister()">Register</button>
                            <div class="toggle-auth">Already have an account? <a onclick="toggleUserForm('user')">Login</a></div>
                            <div id="userRegResult" class="result"></div>
                        </div>
                    </div>

                    <!-- Organizer Forms -->
                    <div id="organizerAuth" style="display: none;">
                        <!-- Login Form -->
                        <div class="auth-form active" id="organizerLoginForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üé™ Organizer Login</h3>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="organizerLoginEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="organizerLoginPassword" placeholder="Enter password">
                            </div>
                            <button class="btn btn-primary" onclick="organizerLogin()">Login</button>
                            <div class="toggle-auth">Don't have an account? <a onclick="toggleUserForm('organizer')">Register</a></div>
                            <div id="organizerLoginResult" class="result"></div>
                        </div>

                        <!-- Register Form -->
                        <div class="auth-form" id="organizerRegisterForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üé™ Organizer Registration</h3>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="organizerRegUsername" placeholder="Choose username">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="organizerRegEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="organizerRegPassword" placeholder="Create password">
                            </div>
                            <div class="form-group">
                                <label>Confirm Password</label>
                                <input type="password" id="organizerRegPasswordConfirm" placeholder="Confirm password">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="organizerRegPhone" placeholder="e.g., +1-234-567-8900 or 1234567890">
                            </div>
                            <button class="btn btn-primary" onclick="organizerRegister()">Register</button>
                            <div class="toggle-auth">Already have an account? <a onclick="toggleUserForm('organizer')">Login</a></div>
                            <div id="organizerRegResult" class="result"></div>
                        </div>
                    </div>

                    <!-- Admin Forms -->
                    <div id="adminAuth" style="display: none;">
                        <!-- Login Form -->
                        <div class="auth-form active" id="adminLoginForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üë®‚Äçüíº Admin Login</h3>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="adminLoginEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="adminLoginPassword" placeholder="Enter password">
                            </div>
                            <button class="btn btn-primary" onclick="adminLogin()">Login</button>
                            <div class="toggle-auth">Don't have an account? <a onclick="toggleUserForm('admin')">Register</a></div>
                            <div id="adminLoginResult" class="result"></div>
                        </div>

                        <!-- Register Form -->
                        <div class="auth-form" id="adminRegisterForm">
                            <h3 style="margin-bottom: 20px; color: #333;">üë®‚Äçüíº Admin Registration</h3>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="adminRegUsername" placeholder="Choose username">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="adminRegEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="adminRegPassword" placeholder="Create password">
                            </div>
                            <div class="form-group">
                                <label>Confirm Password</label>
                                <input type="password" id="adminRegPasswordConfirm" placeholder="Confirm password">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="adminRegPhone" placeholder="e.g., +1-234-567-8900 or 1234567890">
                            </div>
                            <button class="btn btn-primary" onclick="adminRegister()">Register</button>
                            <div class="toggle-auth">Already have an account? <a onclick="toggleUserForm('admin')">Login</a></div>
                            <div id="adminRegResult" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1 id="dashboardTitle">Welcome!</h1>
                        <p id="dashboardSubtitle">Manage your events and registrations</p>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated by JavaScript -->
                </div>

                <!-- Content based on role -->
                <div class="content-grid" id="contentGrid">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let currentUser = null;
        let currentRole = 'user';

        // Auth Functions
        function switchRole(role) {
            currentRole = role;
            
            // Update tabs
            document.querySelectorAll('.role-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Show/hide auth sections
            document.getElementById('userAuth').style.display = role === 'user' ? 'block' : 'none';
            document.getElementById('organizerAuth').style.display = role === 'organizer' ? 'block' : 'none';
            document.getElementById('adminAuth').style.display = role === 'admin' ? 'block' : 'none';
        }

        function toggleUserForm(role) {
            const loginForm = document.getElementById(role + 'LoginForm');
            const registerForm = document.getElementById(role + 'RegisterForm');

            loginForm.classList.toggle('active');
            registerForm.classList.toggle('active');
        }

        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (currentUser?.token) {
                    options.headers['Authorization'] = `Bearer ${currentUser.token}`;
                }

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${API_URL}${endpoint}`, options);
                return await response.json();
            } catch (error) {
                return { success: false, message: error.message };
            }
        }

        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${data.success ? 'success' : 'error'}`;
            element.style.display = 'block';
        }

        // User Auth
        async function userRegister() {
            const password = document.getElementById('userRegPassword').value;
            const passwordConfirm = document.getElementById('userRegPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                showResult('userRegResult', { error: 'Passwords do not match' });
                return;
            }

            const data = {
                username: document.getElementById('userRegUsername').value,
                email: document.getElementById('userRegEmail').value,
                password: password,
                confirmPassword: passwordConfirm,
                phoneNumber: document.getElementById('userRegPhone').value || '+1-000-000-0000',
                role: 'user'
            };

            if (!data.username || !data.email || !data.password) {
                showResult('userRegResult', { error: 'Please fill all required fields' });
                return;
            }

            const result = await apiCall('/auth/register', 'POST', data);
            showResult('userRegResult', result);
        }

        async function userLogin() {
            const data = {
                email: document.getElementById('userLoginEmail').value,
                password: document.getElementById('userLoginPassword').value
            };

            if (!data.email || !data.password) {
                showResult('userLoginResult', { error: 'Please enter email and password' });
                return;
            }

            const result = await apiCall('/auth/login', 'POST', data);
            if (result.success && result.data?.token) {
                currentUser = { ...result.data, role: 'user' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard('user');
            }
            showResult('userLoginResult', result);
        }

        // Organizer Auth
        async function organizerRegister() {
            const password = document.getElementById('organizerRegPassword').value;
            const passwordConfirm = document.getElementById('organizerRegPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                showResult('organizerRegResult', { error: 'Passwords do not match' });
                return;
            }

            const data = {
                username: document.getElementById('organizerRegUsername').value,
                email: document.getElementById('organizerRegEmail').value,
                password: password,
                confirmPassword: passwordConfirm,
                phoneNumber: document.getElementById('organizerRegPhone').value || '+1-000-000-0000',
                role: 'organizer'
            };

            if (!data.username || !data.email || !data.password) {
                showResult('organizerRegResult', { error: 'Please fill all required fields' });
                return;
            }

            const result = await apiCall('/auth/register', 'POST', data);
            showResult('organizerRegResult', result);
        }

        async function organizerLogin() {
            const data = {
                email: document.getElementById('organizerLoginEmail').value,
                password: document.getElementById('organizerLoginPassword').value
            };

            if (!data.email || !data.password) {
                showResult('organizerLoginResult', { error: 'Please enter email and password' });
                return;
            }

            const result = await apiCall('/auth/login', 'POST', data);
            if (result.success && result.data?.token) {
                currentUser = { ...result.data, role: 'organizer' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard('organizer');
            }
            showResult('organizerLoginResult', result);
        }

        // Admin Auth
        async function adminRegister() {
            const password = document.getElementById('adminRegPassword').value;
            const passwordConfirm = document.getElementById('adminRegPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                showResult('adminRegResult', { error: 'Passwords do not match' });
                return;
            }

            const data = {
                username: document.getElementById('adminRegUsername').value,
                email: document.getElementById('adminRegEmail').value,
                password: password,
                confirmPassword: passwordConfirm,
                phoneNumber: document.getElementById('adminRegPhone').value || '+1-000-000-0000',
                role: 'admin'
            };

            if (!data.username || !data.email || !data.password) {
                showResult('adminRegResult', { error: 'Please fill all required fields' });
                return;
            }

            const result = await apiCall('/auth/register', 'POST', data);
            showResult('adminRegResult', result);
        }

        async function adminLogin() {
            const data = {
                email: document.getElementById('adminLoginEmail').value,
                password: document.getElementById('adminLoginPassword').value
            };

            if (!data.email || !data.password) {
                showResult('adminLoginResult', { error: 'Please enter email and password' });
                return;
            }

            const result = await apiCall('/auth/login', 'POST', data);
            if (result.success && result.data?.token) {
                currentUser = { ...result.data, role: 'admin' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard('admin');
            }
            showResult('adminLoginResult', result);
        }

        function showDashboard(role) {
            document.getElementById('authPage').classList.remove('active');
            document.getElementById('dashboardPage').classList.add('active');
            document.getElementById('sidebar').style.display = 'flex';

            // Update header
            const icon = role === 'user' ? 'üë§' : role === 'organizer' ? 'üé™' : 'üë®‚Äçüíº';
            document.getElementById('dashboardTitle').textContent = `Welcome ${icon} ${currentUser.username}!`;
            document.getElementById('dashboardSubtitle').textContent = `You are logged in as ${role.toUpperCase()}`;
            document.getElementById('currentRole').textContent = role.toUpperCase();
            document.getElementById('userBadge').textContent = role.toUpperCase();

            // Build navigation and content based on role
            buildRoleContent(role);
        }

        function buildRoleContent(role) {
            const navMenu = document.getElementById('navMenu');
            const contentGrid = document.getElementById('contentGrid');
            navMenu.innerHTML = '';
            contentGrid.innerHTML = '';

            if (role === 'user') {
                navMenu.innerHTML = `
                    <div class="nav-item active" onclick="switchPage('events')"><span>üìÖ</span>Browse Events</div>
                    <div class="nav-item" onclick="switchPage('myRegistrations')"><span>‚úÖ</span>My Registrations</div>
                    <div class="nav-item" onclick="switchPage('profile')"><span>üë§</span>My Profile</div>
                `;

                contentGrid.innerHTML = `
                    <div id="eventsCard" class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Available Events</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadEvents()">Load Events</button>
                        <div id="eventsList" style="margin-top: 20px;"></div>
                    </div>
                    
                    <div id="myRegistrationsCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">‚úÖ</div>
                            <h3>My Registrations</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadMyRegistrations()">Load My Registrations</button>
                        <div id="registrationsList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="profileCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">üë§</div>
                            <h3>My Profile</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadUserProfile()">Load Profile</button>
                        <div id="profileInfo" style="margin-top: 20px;"></div>
                    </div>
                `;
            } else if (role === 'organizer') {
                navMenu.innerHTML = `
                    <div class="nav-item active" onclick="switchPage('createEvent')"><span>‚ûï</span>Create Event</div>
                    <div class="nav-item" onclick="switchPage('myEvents')"><span>üìÖ</span>My Events</div>
                    <div class="nav-item" onclick="switchPage('eventRegistrations')"><span>‚úÖ</span>Event Registrations</div>
                    <div class="nav-item" onclick="switchPage('profile')"><span>üë§</span>My Profile</div>
                `;

                contentGrid.innerHTML = `
                    <div id="createEventCard" class="card">
                        <div class="card-header">
                            <div class="card-icon">‚ûï</div>
                            <h3>Create New Event</h3>
                        </div>
                        <div class="form-group">
                            <label>Event Name</label>
                            <input type="text" id="eventName" placeholder="Event name">
                        </div>
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="eventDate">
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="eventLocation" placeholder="Location">
                        </div>
                        <div class="form-group">
                            <label>Capacity</label>
                            <input type="number" id="eventCapacity" placeholder="Max attendees" min="1">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="eventDescription" placeholder="Event description"></textarea>
                        </div>
                        <button class="btn btn-success" onclick="createEvent()">Create Event</button>
                        <div id="createEventResult" class="result"></div>
                    </div>

                    <div id="myEventsCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>My Events</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadMyEvents()">Load My Events</button>
                        <div id="myEventsList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="eventRegistrationsCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">‚úÖ</div>
                            <h3>Event Registrations</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadEventRegistrations()">Load Registrations</button>
                        <div id="registrationsDisplay" style="margin-top: 20px;"></div>
                    </div>

                    <div id="profileCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">üë§</div>
                            <h3>My Profile</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadUserProfile()">Load Profile</button>
                        <div id="profileInfo" style="margin-top: 20px;"></div>
                    </div>
                `;
            } else if (role === 'admin') {
                navMenu.innerHTML = `
                    <div class="nav-item active" onclick="switchPage('allEvents')"><span>üìÖ</span>All Events</div>
                    <div class="nav-item" onclick="switchPage('allUsers')"><span>üë•</span>All Users</div>
                    <div class="nav-item" onclick="switchPage('allRegistrations')"><span>‚úÖ</span>All Registrations</div>
                    <div class="nav-item" onclick="switchPage('profile')"><span>üë§</span>My Profile</div>
                `;

                contentGrid.innerHTML = `
                    <div id="allEventsCard" class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>All Events</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadAllEvents()">Load All Events</button>
                        <div id="allEventsList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="allUsersCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">üë•</div>
                            <h3>All Users</h3>
                        </div>
                        <p style="color: #666;">Admin can view all system users here</p>
                        <div id="allUsersList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="allRegistrationsCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">‚úÖ</div>
                            <h3>All Registrations</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadAllRegistrations()">Load All Registrations</button>
                        <div id="allRegistrationsList" style="margin-top: 20px;"></div>
                    </div>

                    <div id="profileCard" class="card" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">üë§</div>
                            <h3>My Profile</h3>
                        </div>
                        <button class="btn btn-primary" onclick="loadUserProfile()">Load Profile</button>
                        <div id="profileInfo" style="margin-top: 20px;"></div>
                    </div>
                `;
            }
        }

        function switchPage(page) {
            // Hide all cards
            document.querySelectorAll('.card').forEach(card => card.style.display = 'none');

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');

            // Show selected card
            const cardId = page + 'Card';
            const card = document.getElementById(cardId);
            if (card) card.style.display = 'block';
        }

        // Event Functions
        async function createEvent() {
            const data = {
                eventName: document.getElementById('eventName').value,
                eventDate: document.getElementById('eventDate').value,
                location: document.getElementById('eventLocation').value,
                capacity: parseInt(document.getElementById('eventCapacity').value),
                description: document.getElementById('eventDescription').value
            };

            if (!data.eventName || !data.eventDate || !data.location) {
                showResult('createEventResult', { error: 'Please fill all required fields' });
                return;
            }

            const result = await apiCall('/events', 'POST', data);
            showResult('createEventResult', result);
            if (result.success) {
                document.getElementById('eventName').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventLocation').value = '';
                document.getElementById('eventCapacity').value = '';
                document.getElementById('eventDescription').value = '';
            }
        }

        async function loadEvents() {
            const result = await apiCall('/events', 'GET');
            const list = document.getElementById('eventsList');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(event => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <h4>${event.eventName}</h4>
                        <p><strong>Location:</strong> ${event.location}</p>
                        <p><strong>Capacity:</strong> ${event.capacity}</p>
                        <p><strong>Date:</strong> ${new Date(event.eventDate).toLocaleString()}</p>
                        <button class="btn btn-success" style="width: auto; padding: 8px 15px;" onclick="registerForEvent('${event.event_uuid}')">Register</button>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p style="color: #f44336;">No events found</p>';
            }
        }

        async function loadMyRegistrations() {
            const result = await apiCall('/registrations', 'GET');
            const list = document.getElementById('registrationsList');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(reg => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <p><strong>Event:</strong> ${reg.Event?.eventName || 'N/A'}</p>
                        <p><strong>Status:</strong> <span style="color: #4caf50;">${reg.status || 'Active'}</span></p>
                        <p><strong>Registered on:</strong> ${new Date(reg.createdAt).toLocaleString()}</p>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p style="color: #666;">No registrations yet</p>';
            }
        }

        async function registerForEvent(eventUUID) {
            const result = await apiCall('/registrations', 'POST', { eventUUID });
            alert(result.success ? 'Successfully registered!' : 'Registration failed: ' + result.message);
            loadEvents();
        }

        async function loadMyEvents() {
            const result = await apiCall('/events', 'GET');
            const list = document.getElementById('myEventsList');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(event => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <h4>${event.eventName}</h4>
                        <p><strong>Location:</strong> ${event.location}</p>
                        <p><strong>Capacity:</strong> ${event.capacity}</p>
                        <p><strong>Description:</strong> ${event.description}</p>
                        <button class="btn btn-danger" style="width: auto; padding: 8px 15px;" onclick="deleteEvent('${event.event_uuid}')">Delete</button>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p style="color: #666;">No events created yet</p>';
            }
        }

        async function loadEventRegistrations() {
            const result = await apiCall('/registrations', 'GET');
            const list = document.getElementById('registrationsDisplay');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(reg => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <p><strong>User:</strong> ${reg.User?.username || 'N/A'}</p>
                        <p><strong>Event:</strong> ${reg.Event?.eventName || 'N/A'}</p>
                        <p><strong>Status:</strong> <span style="color: #4caf50;">${reg.status || 'Active'}</span></p>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p style="color: #666;">No registrations</p>';
            }
        }

        async function deleteEvent(eventUUID) {
            if (confirm('Are you sure?')) {
                const result = await apiCall(`/events/${eventUUID}`, 'DELETE');
                alert(result.success ? 'Event deleted!' : 'Failed to delete');
                loadMyEvents();
            }
        }

        async function loadAllEvents() {
            const result = await apiCall('/events', 'GET');
            const list = document.getElementById('allEventsList');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(event => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <h4>${event.eventName}</h4>
                        <p><strong>Organizer:</strong> ${event.User?.username || 'N/A'}</p>
                        <p><strong>Location:</strong> ${event.location}</p>
                        <p><strong>Capacity:</strong> ${event.capacity}</p>
                    </div>
                `).join('');
            }
        }

        async function loadAllRegistrations() {
            const result = await apiCall('/registrations', 'GET');
            const list = document.getElementById('allRegistrationsList');
            if (result.success && result.data) {
                list.innerHTML = result.data.map(reg => `
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
                        <p><strong>User:</strong> ${reg.User?.username || 'N/A'}</p>
                        <p><strong>Event:</strong> ${reg.Event?.eventName || 'N/A'}</p>
                        <p><strong>Registered on:</strong> ${new Date(reg.createdAt).toLocaleString()}</p>
                    </div>
                `).join('');
            }
        }

        async function loadUserProfile() {
            const result = await apiCall('/user/profile', 'GET');
            const info = document.getElementById('profileInfo');
            if (result.success && result.data) {
                const user = result.data;
                info.innerHTML = `
                    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
                        <p><strong>Username:</strong> ${user.username}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Phone:</strong> ${user.phoneNumber || 'N/A'}</p>
                        <p><strong>Role:</strong> ${user.role?.toUpperCase()}</p>
                        <p><strong>Joined:</strong> ${new Date(user.createdAt).toLocaleString()}</p>
                    </div>
                `;
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('authPage').classList.add('active');
            document.getElementById('dashboardPage').classList.remove('active');
            document.getElementById('sidebar').style.display = 'none';
        }

        // Check if user is already logged in
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                showDashboard(currentUser.role);
            }
        });
    </script>
</body>
</html>